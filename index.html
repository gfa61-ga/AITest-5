<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>AI multiple choice Quiz - gemini 3 Pro - final</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <style>
    /* -- Î•ÎºÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î­Î½Î¿ Design, dark/light support -- */
    :root {
      --blue: #2563eb;
      --blue-dark: #1e40af;
      --bg-lighter: #f0f9ff;
      --gray: #f3f4f6;
      --border: #e5e7eb;
      --green: #10b981;
      --red: #ef4444;
      --yellow: #f59e0b;
      --font-main: "Inter", "Segoe UI", system-ui, sans-serif;
    }
    html, body {background: var(--bg-lighter); margin: 0; font-family: var(--font-main); color: var(--blue-dark);}
    h1, h2 {color: var(--blue-dark);}
    main {max-width: 760px; margin: 0 auto;}
    .box {background: white; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid var(--border); padding: 1.5em;margin-bottom: 2em;}
    .option-row {margin:1em 0;display:flex;flex-wrap:wrap;align-items:center;gap:1em;}
    .cta-row {margin:2.5em 0 1em 0;display:flex;align-items:center;gap:1em;}
    .btn {background: var(--blue); color: white; padding: 0.7em 2.1em; font-size: 1.13em; font-weight:700; border:none; border-radius: 8px; transition: background .2s; cursor: pointer;}
    .btn:hover {background: var(--blue-dark);}
    select, .count-field {font-size:1.09em; border-radius:7px; border:1px solid #e5e7eb;padding: .3em .6em;}
    @media (max-width:600px){
      main {padding: .8em;}
      .option-row, .cta-row {flex-direction:column;align-items:stretch;}
    }
    /* ÎšÎµÎ½Ï„ÏÎ¹ÎºÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ */
    table {width:100%;background: var(--gray);}
    th,td{padding:.55em 8px;border: 1px solid var(--border);}
    th{background:var(--blue);color:white;}
    tr:nth-child(even) td{background: #f8fafc;}
    .test-type-label{display:inline-block; font-size:.97em; border-radius:6px; background:#d1fae5;color:var(--blue-dark);padding:.12em .6em;vertical-align:middle;}
    /* Quiz Section */
    .quiz-view {margin-top:1.5em;}
    .q-panel{background: white; border:1.5px solid var(--border);border-radius:12px;box-shadow:0 1px 6px #c7c7c73a;padding:1.6em;}
    .progress{font-size:1.09em; margin-bottom:1em;}
    .question-title{font-size:1.07em; font-weight:600; margin:0 0 1em 0;}
    .choice-btn{display:block;padding:.8em;margin-bottom:.5em;background:#eff6ff;border-radius:7px;font-size:1.08em;border:1.5px solid #c3cdea;cursor:pointer;transition:background .15s;}
    .choice-btn.selected, .choice-btn:hover{background:var(--blue);color:white;border-color:var(--blue);}
    .next-btn, .finish-btn {margin:0 0.4em;padding:.6em 1.5em; font-size:1.09em;}
    .disabled{filter:grayscale(.8);opacity:0.7;cursor:not-allowed;}
    
    button.disabled {
      pointer-events: none;
      background: #d1d5db;
      color: #6b7280;
    }
    
    button.disabled:hover {
      background: #d1d5db;
    }
    
    /* Results, ÎµÎ¼Ï€Î»Î¿Ï…Ï„Î¹ÏƒÎ¼Î­Î½Î¿ styling: */

    /* === RESPONSIVE BUTTONS === */
    .actions {
      display: flex;
      gap: 1.3em;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .actions .btn {
      flex: 1;
      min-width: 140px;
      white-space: nowrap;
      padding: 0.8em 1.5em;
      font-size: 1em;
      font-weight: 700;
    }
    
    @media (max-width: 768px) {
      .actions {
        flex-direction: column;
        gap: 0.8em;
        align-items: stretch;
      }
      
      .actions .btn {
        width: 100%;
        min-width: unset;
        padding: 0.9em 1em;
        font-size: 0.95em;
      }
    }
    
    @media (max-width: 480px) {
      .actions {
        gap: 0.6em;
      }
      
      .actions .btn {
        padding: 0.8em 0.8em;
        font-size: 0.9em;
      }
    }
    
    /* === PROGRESS TRACKING === */
    .progress-container {
      background: #f0f9ff;
      border: 1px solid #c3cdea;
      border-radius: 10px;
      padding: 1em;
      margin-bottom: 1.2em;
    }
    
    .progress-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8em;
      flex-wrap: wrap;
      gap: 1em;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .stat-label {
      font-size: 0.85em;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.3em;
    }
    
    .stat-value {
      font-size: 1.5em;
      font-weight: 800;
      color: var(--blue-dark);
    }
    
    .stat-value.answered {
      color: var(--green);
    }
    
    .stat-value.remaining {
      color: var(--yellow);
    }
    
    .progress-bar-container {
      background: #e5e7eb;
      border-radius: 8px;
      height: 24px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar-fill {
      background: linear-gradient(90deg, var(--green), var(--blue));
      height: 100%;
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75em;
      font-weight: 700;
      color: white;
    }
    
    .progress-info {
      margin-top: 0.6em;
      font-size: 0.9em;
      color: #666;
      text-align: center;
    }
    
    .submit-hint {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      padding: 0.6em 0.8em;
      margin-top: 0.8em;
      font-size: 0.85em;
      color: #1e40af;
      text-align: center;
    }
    
    .submit-hint.ready {
      background: #d1fae5;
      border-color: #10b981;
      color: #065f46;
    }
    
    @media (max-width: 480px) {
      .progress-stats {
        gap: 0.5em;
      }
      
      .stat-label {
        font-size: 0.75em;
      }
      
      .stat-value {
        font-size: 1.2em;
      }
      
      .progress-bar-fill {
        font-size: 0.65em;
      }
    }
    
    /* Results, ÎµÎ¼Ï€Î»Î¿Ï…Ï„Î¹ÏƒÎ¼Î­Î½Î¿ styling: */
    .score-summary{margin-bottom:1.6em;}
    .score-label{font-size:1.13em;font-weight:600;}
    .score-fraction{font-size:1.6em; font-weight:800; color:var(--blue-dark);}
    .score-grade{font-size:.98em;}
    .results-list{margin-top:1.7em;}
    .result-item {margin-bottom:1.2em;background:#f9fafb;padding:1em 1.4em 1em .9em;border-radius:8px;border-left:5px solid #dbeafe;}
    .result-item.correct{border-color:var(--green);}
    .result-item.incorrect{border-color:var(--red);}
    .result-header{display:flex;align-items:center;gap:.5em;}
    .result-number{font-size:1.05em;}
    .result-status{font-size:1.1em;}
    .result-question{font-size:1.09em;font-weight:500;margin:.7em 0;}
    .user-answer{background:var(--gray);padding:.4em;border-radius:6px;display:inline-block;}
    .answer-choice{margin-right:.4em;}
    .correct-answer{margin-top:.45em;background:#d1fae5;padding:.36em .6em;border-radius:.5em;display:inline-block;}
    
    .result-explanation {
      margin-top: 0.6em;
      padding: 0.5em 0.75em;
      border-radius: 6px;
      background: #eff6ff;
      color: #1e3a8a;
      font-size: 0.9rem;
    }

    .result-explanation .explanation-text {
      margin-left: 0.25rem;
      display: inline-block;
    }
    /* === RESULTS CHAPTER BADGE === */
    .result-item.with-chapter {
      padding-left: 1.2em;
    }
    
    .result-chapter-badge {
      display: inline-block;
      background: var(--blue);
      color: white;
      padding: 0.25em 0.6em;
      border-radius: 15px;
      font-size: 0.75em;
      font-weight: 700;
      margin-right: 0.6em;
      vertical-align: middle;
    }
    
    .result-chapter-badge.ch1 { background: #3b82f6; }
    .result-chapter-badge.ch2 { background: #8b5cf6; }
    .result-chapter-badge.ch3 { background: #ec4899; }
    .result-chapter-badge.ch4 { background: #f59e0b; }
    .result-chapter-badge.ch5 { background: #10b981; }
    .result-chapter-badge.ch6 { background: #14b8a6; }
    .result-chapter-badge.ch7 { background: #06b6d4; }
    .result-chapter-badge.ch8 { background: #0891b2; }
    .result-chapter-badge.ch9 { background: #0284c7; }
    .result-chapter-badge.ch10 { background: #2563eb; }
    .result-chapter-badge.ch11 { background: #7c3aed; }
    .result-chapter-badge.ch12 { background: #db2777; }
    .result-chapter-badge.ch13 { background: #ea580c; }
    .result-chapter-badge.ch14 { background: #16a34a; }
    .result-chapter-badge.ch15 { background: #0d9488; }

    /* === CHAPTER BADGE === */
    .chapter-badge {
      display: inline-block;
      background: var(--blue);
      color: white;
      padding: 0.3em 0.7em;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 700;
      margin-right: 0.8em;
      margin-bottom: 0.8em;
    }
    
    .chapter-badge.ch1 { background: #3b82f6; }
    .chapter-badge.ch2 { background: #8b5cf6; }
    .chapter-badge.ch3 { background: #ec4899; }
    .chapter-badge.ch4 { background: #f59e0b; }
    .chapter-badge.ch5 { background: #10b981; }
    .chapter-badge.ch6 { background: #14b8a6; }
    .chapter-badge.ch7 { background: #06b6d4; }
    .chapter-badge.ch8 { background: #0891b2; }
    .chapter-badge.ch9 { background: #0284c7; }
    .chapter-badge.ch10 { background: #2563eb; }
    .chapter-badge.ch11 { background: #7c3aed; }
    .chapter-badge.ch12 { background: #db2777; }
    .chapter-badge.ch13 { background: #ea580c; }
    .chapter-badge.ch14 { background: #16a34a; }
    .chapter-badge.ch15 { background: #0d9488; }
    
    .question-header {
      display: flex;
      align-items: center;
      margin-bottom: 1em;
      flex-wrap: wrap;
    }
    
    /* Loader */
    .loader {border:6px solid #e5e7eb;border-top: 6px solid var(--blue);border-radius:50%;width:42px;height:42px;animation:spin 1.1s linear infinite;margin: 2em auto;}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    /* Error/Empty states */
    .error-box{max-width:400px;margin:1.5em auto;background:#fee2e2;color:#991b1b;padding:1.4em;border-radius:11px;}
    .hidden{display:none;}
  </style>
</head>
<body>
<main>
  <h1>AI multiple choice Quiz - gemini 3 Pro - final</h1>
  <div class="box" id="main-menu">
    <h2>ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Quiz</h2>
    
    <div class="option-row">
      <label for="chapter-select">20 Ï„Ï…Ï‡Î±Î¯ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿:</label>
      <select id="chapter-select">
        <option value="1">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 1</option>
        <option value="2">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 2</option>
        <option value="3">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 3</option>
        <option value="4">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 4</option>
        <option value="5">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 5</option>
        <option value="6">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 6</option>
        <option value="7">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 7</option>
        <option value="8">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 8</option>
        <option value="9">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 9</option>
        <option value="10">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 10</option>
        <option value="11">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 11</option>
        <option value="12">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 12</option>
        <option value="13">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 13</option>
        <option value="14">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 14</option>
        <option value="15">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 15</option>
      </select>
      <button id="start-20-random" class="btn">20 Ï„Ï…Ï‡Î±Î¯ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚</button>
    </div>
    
    <div class="option-row">
      <button id="start-60-random" class="btn">60 Ï„Ï…Ï‡Î±Î¯ÎµÏ‚ Î±Ï€' ÏŒÎ»Î± Ï„Î± ÎºÎµÏ†Î¬Î»Î±Î¹Î± (Î±Î½Î±Î»Î¿Î³Î¹ÎºÎ® ÎºÎ±Ï„Î±Î½Î¿Î¼Î®)</button>
    </div>

    <div class="option-row">
      <label for="chapter-select-all">ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿:</label>
      <select id="chapter-select-all">
        <option value="1">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 1</option>
        <option value="2">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 2</option>
        <option value="3">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 3</option>
        <option value="4">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 4</option>
        <option value="5">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 5</option>
        <option value="6">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 6</option>
        <option value="7">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 7</option>
        <option value="8">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 8</option>
        <option value="9">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 9</option>
        <option value="10">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 10</option>
        <option value="11">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 11</option>
        <option value="12">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 12</option>
        <option value="13">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 13</option>
        <option value="14">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 14</option>
        <option value="15">ÎšÎµÏ†Î¬Î»Î±Î¹Î¿ 15</option>
      </select>
      <button id="start-all-chapter" class="btn">ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚</button>
    </div>
    
    <div class="cta-row">
      <span class="test-type-label" id="current-mode"></span>
    </div>
    
    <h3>ÎšÎµÏ†Î¬Î»Î±Î¹Î± &amp; Ï€Î»Î®Î¸Î¿Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½</h3>
    <table>
      <thead>
        <tr><th>#</th><th>ÎšÎµÏ†Î¬Î»Î±Î¹Î¿</th><th>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎµÏÏ‰Ï„.</th></tr>
      </thead>
      <tbody id="chapters-table"></tbody>
    </table>
  </div>
  
  <!-- Quiz panel -->
  <div id="quiz-panel" class="box hidden">
    <div id="quiz-meta">
      <span id="progress-txt"></span>
      
      <!-- Progress Tracking -->
      <div class="progress-container">
        <div class="progress-stats">
          <div class="stat-item">
            <div class="stat-label">Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚</div>
            <div class="stat-value">
              <span class="answered" id="answered-count">0</span>/<span id="total-count">0</span>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Î‘Ï€Î±Î½Ï„Î·Î¼Î­Î½ÎµÏ‚</div>
            <div class="stat-value answered" id="answered-percent">0%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Î‘Ï€Î¿Î¼Î­Î½Î¿Ï…Î½</div>
            <div class="stat-value remaining" id="remaining-count">0</div>
          </div>
        </div>
        
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%">
            <span id="progress-percent-text">0%</span>
          </div>
        </div>
        
        <div class="progress-info" id="progress-info">
          Î‘Ï€Î±Î½Ï„Î®ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ "Î¥Ï€Î¿Î²Î¿Î»Î®"
        </div>
        
        <div class="submit-hint" id="submit-hint">
          â³ Î‘Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±ÎºÏŒÎ¼Î± <span id="remaining-questions">0</span> Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·(ÎµÏ‚)
        </div>
      </div>
    </div>
    <div class="q-panel">
      <div class="question-header">
        <span class="chapter-badge" id="chapter-badge" style="display:none;"></span>
        <div class="question-title" id="question-title"></div>
      </div>
      <div id="choices-area"></div>
    </div>
    <div class="actions">
      <button id="prev-question" class="btn" type="button">Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î·</button>
      <button id="next-question" class="btn" type="button">Î•Ï€ÏŒÎ¼ÎµÎ½Î·</button>
      <button id="finish-quiz" class="btn" type="button">Î¥Ï€Î¿Î²Î¿Î»Î®</button>
    </div>
    <div id="quiz-loader" class="loader hidden"></div>
  </div>
  
  <!-- Results modal -->
  <div id="results-modal" class="box hidden" aria-modal="true" role="dialog">
    <h2>Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Test</h2>
    <div class="score-summary">
      <span class="score-label">Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±:</span>
      <span class="score-fraction" id="score-fraction"></span>
      <span id="score-percentage"></span>
      <span class="score-grade" id="score-grade"></span>
    </div>
    <div class="results-list" id="results-list"></div>
    <div class="actions">
      <button id="retry-test" class="btn">ÎÎ±Î½Î¬ Ï„Î¿ Î¯Î´Î¹Î¿ Ï„ÎµÏƒÏ„</button>
      <button id="return-home" class="btn">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î¼ÎµÎ½Î¿Ï</button>
    </div>
  </div>
  
  <!-- Loader -->
  <div class="loader hidden" id="main-loader"></div>
  <!-- Error -->
  <div class="error-box hidden" id="error-view"></div>
</main>

<script>
// === Utility ===
function shuffleArray(array) {
    const a = array.slice();
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

// === ÎœÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÎºÎµÏ†Î±Î»Î±Î¯Ï‰Î½ ===
const CHAPTERS = [
  { number: 1, title: "Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ÏƒÏ„Î·Î½ Î¤ÎµÏ‡Î½Î·Ï„Î® ÎÎ¿Î·Î¼Î¿ÏƒÏÎ½Î·", file: "test_kefalaio_1.json", count: 70 },
  { number: 2, title: "Î”Î¹Î±ÏƒÏÎ½Î´ÎµÏƒÎ· AI Î¼Îµ Î†Î»Î»ÎµÏ‚ Î¤ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯ÎµÏ‚", file: "test_kefalaio_2.json", count: 70 },
  { number: 3, title: "Î— Î‘Î¾Î¯Î± Ï„Ï‰Î½ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¹Î± Ï„Î·Î½ AI", file: "test_kefalaio_3.json", count: 62 },
  { number: 4, title: "Î‘Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿Î¹ ÎºÎ±Î¹ ÎœÎ¿Î½Ï„Î­Î»Î± ÎœÎ·Ï‡Î±Î½Î¹ÎºÎ®Ï‚ ÎœÎ¬Î¸Î·ÏƒÎ·Ï‚", file: "test_kefalaio_4.json", count: 70 },
  { number: 5, title: "ÎÎµÏ…ÏÏ‰Î½Î¹ÎºÎ¬ Î”Î¯ÎºÏ„Ï…Î± ÎºÎ±Î¹ Î’Î±Î¸Î¹Î¬ ÎœÎ¬Î¸Î·ÏƒÎ·", file: "test_kefalaio_5.json", count: 60 },
  { number: 6, title: "Î‘Î½Î¬Ï€Ï„Ï…Î¾Î· ÎºÎ±Î¹ Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· ÎœÎ¿Î½Ï„Î­Î»Ï‰Î½ AI", file: "test_kefalaio_6.json", count: 60 },
  { number: 7, title: "Natural Language Processing (NLP)", file: "test_kefalaio_7.json", count: 70 },
  { number: 8, title: "Computer Vision", file: "test_kefalaio_8.json", count: 71 },
  { number: 9, title: "Î¡Î¿Î¼Ï€Î¿Ï„Î¹ÎºÎ® ÎºÎ±Î¹ Î‘Ï…Ï„Î¿Î½Î¿Î¼Î¯Î±", file: "test_kefalaio_9.json", count: 70 },
  { number: 10, title: "Î—Î¸Î¹ÎºÎ¬ ÎºÎ±Î¹ ÎÎ¿Î¼Î¹ÎºÎ¬ Î–Î·Ï„Î®Î¼Î±Ï„Î± AI", file: "test_kefalaio_10.json", count: 70 },
  { number: 11, title: "AI ÏƒÏ„Î¿ Marketing", file: "test_kefalaio_11.json", count: 90 },
  { number: 12, title: "AI ÏƒÏ„Î·Î½ Î¥Î³ÎµÎ¯Î±", file: "test_kefalaio_12.json", count: 60 },
  { number: 13, title: "Conversational AI ÎºÎ±Î¹ Personal Assistants", file: "test_kefalaio_13.json", count: 60 },
  { number: 14, title: "AI ÏƒÏ„Î¹Ï‚ Î•Ï€Î¹Ï‡ÎµÎ¹ÏÎ®ÏƒÎµÎ¹Ï‚", file: "test_kefalaio_14.json", count: 60 },
  { number: 15, title: "Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Î¹ Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· AI", file: "test_kefalaio_15.json", count: 59 }
];

// === Global Quiz State ===
let appState = {
    mode: null,
    chapter: null,
    questions: [],
    currentIdx: 0,
    userAnswers: [],
    quizTitle: "",
    originalSource: [],
};

// === DOM Elements ===
const $mainMenu = document.getElementById('main-menu');
const $quizPanel = document.getElementById('quiz-panel');
const $resultsModal = document.getElementById('results-modal');
const $mainLoader = document.getElementById('main-loader');
const $errorView = document.getElementById('error-view');
const $chaptersTable = document.getElementById('chapters-table');
const $currentMode = document.getElementById('current-mode');

// -- Load chapters table
function renderChaptersList() {
    $chaptersTable.innerHTML = "";
    CHAPTERS.forEach(chap =>
      $chaptersTable.innerHTML += `<tr>
        <td>${chap.number}</td>
        <td>${chap.title}</td>
        <td>${chap.count}</td>
      </tr>`
    );
}
renderChaptersList();

// --- MODE SELECTION ---

document.getElementById('start-20-random').onclick = async () => {
  const chapterNum = parseInt(document.getElementById('chapter-select').value,10);
  const chapter = CHAPTERS.find(c=>c.number===chapterNum);
  if (!chapter) return;
  $mainMenu.classList.add('hidden'); $mainLoader.classList.remove('hidden');
  const data = await fetchQuizJson(chapter.file,true);
  $mainLoader.classList.add('hidden');
  if (!data) return showError("Î‘Î´Ï…Î½Î±Î¼Î¯Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Ï„Î¿ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿!");
  appState.mode = "20random";
  appState.chapter = chapter;
  appState.quizTitle = `20 Ï„Ï…Ï‡Î±Î¯ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ ${chapter.title}`;
  appState.originalSource = shuffleArray(data);
  appState.questions = appState.originalSource.slice(0,20).map(q => shuffleChoices(q));
  appState.currentIdx = 0;
  appState.userAnswers = Array(appState.questions.length).fill(null);
  $currentMode.textContent = appState.quizTitle;
  showQuizPanel();
};

document.getElementById('start-60-random').onclick = async () => {
  $mainMenu.classList.add('hidden');
  $mainLoader.classList.remove('hidden');

  // Î¦ÏŒÏÏ„Ï‰ÏƒÎµ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ ÏŒÎ»Î± Ï„Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± ÎºÎµÏ†Î¬Î»Î±Î¹Î±
  const loadedChapters = [];
  const questionMap = {};
  let total = 0;

  for (const chap of CHAPTERS) {
    const data = await fetchQuizJson(chap.file, true);
    if (!data) continue; // Î±Î½ Î»ÎµÎ¯Ï€ÎµÎ¹ JSON Î³Î¹Î± ÎºÎ¬Ï€Î¿Î¹Î¿ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿, Ï„Î¿ Ï€ÏÎ¿ÏƒÏ€ÎµÏÎ½Î¬Î¼Îµ

    questionMap[chap.number] = data;
    loadedChapters.push({ chap, count: data.length });
    total += data.length;
  }

  if (loadedChapters.length === 0) {
    $mainLoader.classList.add('hidden');
    showError("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± 60Î¬ÏÎ¹ Ï„ÎµÏƒÏ„.");
    return;
  }

  // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏŒÏƒÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î¸Î± Ï€Î¬ÏÎ¿Ï…Î¼Îµ Î±Ï€ÏŒ ÎºÎ¬Î¸Îµ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿ (Î±Î½Î±Î»Î¿Î³Î¯Î±)
  let perCh = [];
  let acc = 0;

  loadedChapters.forEach((entry, idx) => {
    const qn = Math.round((entry.count / total) * 60);
    perCh[idx] = qn;
    acc += qn;
  });

  // Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® ÏÏƒÏ„Îµ Ï„Î¿ Î¬Î¸ÏÎ¿Î¹ÏƒÎ¼Î± Î½Î± ÎµÎ¯Î½Î±Î¹ Î±ÎºÏÎ¹Î²ÏÏ‚ 60
  while (acc < 60) {
    perCh[acc % perCh.length]++;
    acc++;
  }
  while (acc > 60) {
    const idx = perCh.findIndex(x => x > 0);
    if (idx === -1) break;
    perCh[idx]--;
    acc--;
  }

  // Î•Ï€Î¹Î»Î¿Î³Î® Ï„Ï‰Î½ ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½ Î±Î½Î¬ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿
  let collected = [];
  loadedChapters.forEach((entry, idx) => {
    const ch = entry.chap;
    let qset = shuffleArray(questionMap[ch.number] || []);
    const take = Math.min(perCh[idx], qset.length);

    qset.slice(0, take).forEach(q => {
      q._chapter = ch.number; // Î³Î¹Î± Ï„Î¿ badge/Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
    });

    collected = collected.concat(qset.slice(0, take));
  });

  // Î‘Î½Î±ÎºÎ¬Ï„ÎµÎ¼Î± ÎºÎ±Î¹ ÎºÏŒÏˆÎ¹Î¼Î¿ ÏƒÎµ max 60
  collected = shuffleArray(collected).slice(0, 60);

  $mainLoader.classList.add('hidden');
  appState.mode = "60all";
  appState.chapter = null;
  appState.quizTitle = "60 Ï„Ï…Ï‡Î±Î¯ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ ÏŒÎ»Î± Ï„Î± ÎºÎµÏ†Î¬Î»Î±Î¹Î±";
  appState.originalSource = collected.slice();
  appState.questions = collected.map(q => shuffleChoices(q, q._chapter));
  appState.currentIdx = 0;
  appState.userAnswers = Array(appState.questions.length).fill(null);
  $currentMode.textContent = appState.quizTitle;
  showQuizPanel();
};


document.getElementById('start-all-chapter').onclick = async () => {
  const chapterNum = parseInt(document.getElementById('chapter-select-all').value, 10);
  const chapter = CHAPTERS.find(c => c.number === chapterNum);
  if (!chapter) return;
  $mainMenu.classList.add('hidden');
  $mainLoader.classList.remove('hidden');
  const data = await fetchQuizJson(chapter.file, true);
  $mainLoader.classList.add('hidden');
  if (!data) return showError("Î‘Î´Ï…Î½Î±Î¼Î¯Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Ï„Î¿ ÎºÎµÏ†Î¬Î»Î±Î¹Î¿!");
  appState.mode = "all-chapter";
  appState.chapter = chapter;
  appState.quizTitle = `ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - ${chapter.title} (${data.length} ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚)`;
  appState.originalSource = shuffleArray(data);
  appState.questions = appState.originalSource.map(q => shuffleChoices(q));
  appState.currentIdx = 0;
  appState.userAnswers = Array(appState.questions.length).fill(null);
  $currentMode.textContent = appState.quizTitle;
  showQuizPanel();
};

function showError(msg){
  $errorView.classList.remove('hidden');
  $errorView.textContent = msg;
  $quizPanel.classList.add('hidden');
  $mainLoader.classList.add('hidden');
  $mainMenu.classList.remove('hidden');
}

function showQuizPanel() {
  $mainMenu.classList.add('hidden');
  $resultsModal.classList.add('hidden');
  $quizPanel.classList.remove('hidden');
  renderQuestion();
  updateProgress();
  document.getElementById('quiz-loader').classList.add('hidden');
}

// --- QUIZ PLAYBACK ---
function renderQuestion() {
  let q = appState.questions[appState.currentIdx];
  document.getElementById('question-title').textContent = q.question;
  
  // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎºÎµÏ†Î±Î»Î±Î¯Î¿Ï… badge
  const badge = document.getElementById('chapter-badge');
  if (q.chapter) {
    badge.textContent = `ÎšÎµÏ†. ${q.chapter}`;
    badge.className = `chapter-badge ch${q.chapter}`;
    badge.style.display = 'inline-block';
  } else {
    badge.style.display = 'none';
  }
  
  let html = "";
  ["A","B","C","D"].forEach(letter=>{
    html+= `<button class="choice-btn${appState.userAnswers[appState.currentIdx]===letter?" selected":""}" data-choice="${letter}"><span class="answer-choice">${letter}</span> ${q.choices[letter]}</button>`;
  });
  document.getElementById('choices-area').innerHTML = html;
  document.getElementById('prev-question').disabled = appState.currentIdx===0;
  
  // Next: Î‘Ï€Î¿ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î±Î½ Î· Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎµÏÏÏ„Î·ÏƒÎ· Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·
  const isLastQuestion = appState.currentIdx === appState.questions.length - 1;
  const currentAnswered = appState.userAnswers[appState.currentIdx] !== null;
  document.getElementById('next-question').disabled = isLastQuestion || !currentAnswered;
  
  document.getElementById('finish-quiz').style.display = appState.userAnswers.includes(null)?"none":"inline-block";
  updateProgressDisplay();
}


function updateProgress(){
  document.getElementById('progress-txt').textContent = `Î•ÏÏÏ„Î·ÏƒÎ· ${appState.currentIdx+1} Î±Ï€ÏŒ ${appState.questions.length}`;
  updateProgressDisplay();
}

function updateProgressDisplay() {
  const answered = appState.userAnswers.filter(a => a !== null).length;
  const total = appState.questions.length;
  const remaining = total - answered;
  const percent = Math.round((answered / total) * 100);
  
  document.getElementById('answered-count').textContent = answered;
  document.getElementById('total-count').textContent = total;
  document.getElementById('answered-percent').textContent = percent + '%';
  document.getElementById('remaining-count').textContent = remaining;
  document.getElementById('progress-bar-fill').style.width = percent + '%';
  document.getElementById('progress-percent-text').textContent = percent + '%';
  document.getElementById('remaining-questions').textContent = remaining;
  
  const hint = document.getElementById('submit-hint');
  if (remaining === 0) {
    hint.classList.add('ready');
    hint.innerHTML = 'âœ… ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€Î±Î½Ï„Î®Î¸Î·ÎºÎ±Î½! Î Î±Ï„Î®ÏƒÏ„Îµ "Î¥Ï€Î¿Î²Î¿Î»Î®"';
  } else {
    hint.classList.remove('ready');
    hint.innerHTML = `â³ Î‘Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±ÎºÏŒÎ¼Î± <span id="remaining-questions">${remaining}</span> Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·(ÎµÏ‚)`;
  }
}

document.getElementById('choices-area').onclick = e=>{
  let btn = e.target.closest('button.choice-btn');
  if (!btn) return;
  let letter = btn.getAttribute('data-choice');
  appState.userAnswers[appState.currentIdx] = letter;
  renderQuestion();
  updateProgress();
}

document.getElementById('prev-question').onclick = ()=>{
  if (appState.currentIdx>0) appState.currentIdx--;
  renderQuestion();
  updateProgress();
}
document.getElementById('next-question').onclick = ()=>{
  if (appState.currentIdx<appState.questions.length-1) appState.currentIdx++;
  renderQuestion();
  updateProgress();
}
document.getElementById('finish-quiz').onclick = ()=> showResults();

document.getElementById('retry-test').onclick = ()=>{
  appState.questions = shuffleArray(appState.originalSource).slice(0, appState.questions.length).map((q,i)=>{
    if (appState.mode === "60all") {
      return shuffleChoices(q, q._chapter);
    } else {
      return shuffleChoices(q);
    }
  });
  appState.userAnswers = Array(appState.questions.length).fill(null);
  appState.currentIdx = 0;
  showQuizPanel();
};
document.getElementById('return-home').onclick = ()=>{
  $resultsModal.classList.add('hidden');
  $mainMenu.classList.remove('hidden');
  $currentMode.textContent = "";
};

// --- Shuffle choices in each question
function shuffleChoices(question, chapterNum = null) {
    const correct = question.choices[question.answer];
    const arr = ["A","B","C","D"].map(letter=>({letter,text:question.choices[letter]}));
    const shuffled = shuffleArray(arr);
    const newChoices = {};
    let newAnswer = "A";
    shuffled.forEach((c,i)=>{
        newChoices[String.fromCharCode(65+i)] = c.text;
        if (c.text===correct) newAnswer=String.fromCharCode(65+i);
    });
    return {
      question: question.question,
      choices: newChoices,
      answer: newAnswer,
      chapter: chapterNum,
      explanation: question.explanation || null   // ğŸ‘ˆ ÎºÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ explanation
    };
}


// -- Î’Î±ÏƒÎ¹ÎºÎ® fetch Î¼Îµ error handling
async function fetchQuizJson(file, suppressError){
  try{
    const res = await fetch(file);
    if (!res.ok) throw new Error("Not found: "+file);
    const data = await res.json();
    if(!Array.isArray(data) || !data.length) throw new Error("Empty json: "+file);
    return data;
  }catch(e){
    if (!suppressError) showError("Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ quiz Î±ÏÏ‡ÎµÎ¯Î¿Ï…!");
    return null;
  }
}

// --- Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
function showResults(){
  let score = 0;
  appState.questions.forEach((q,i)=>{
    if(appState.userAnswers[i]===q.answer) score++;
  });
  document.getElementById('score-fraction').textContent = `${score}/${appState.questions.length}`;
  let pct = Math.round(100*score/appState.questions.length);
  document.getElementById('score-percentage').textContent = pct + "%";
  let grade = "";
  if (pct>=90) grade="Î†ÏÎ¹ÏƒÏ„Î±! ğŸ‰";
  else if (pct>=75) grade="Î Î¿Î»Ï ÎšÎ±Î»Î¬! ğŸ‘";
  else if (pct>=60) grade="ÎšÎ±Î»Î¬ ğŸ‘";
  else grade = "Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· ğŸ“š";
  document.getElementById('score-grade').textContent = grade;
  let html = "";
  appState.questions.forEach((q,i)=>{
    const user = appState.userAnswers[i];
    const correct = q.answer;
    const correctText = q.choices[correct];
    const userText = user ? (q.choices[user] || "") : "(ÎºÎ±Î¼Î¯Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·)";
    const ok = user === correct;

    // Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ explanation ÏƒÏ„Î¿ JSON, ÎµÏ„Î¿Î¯Î¼Î±ÏƒÎµ HTML block
    const explanationHtml = q.explanation
      ? `<div class="result-explanation">
           <strong>Î•Ï€ÎµÎ¾Î®Î³Î·ÏƒÎ·:</strong>
           <span class="explanation-text">${q.explanation}</span>
         </div>`
      : "";

    html+= `<div class="result-item ${ok?"correct":"incorrect"}">
      <div class="result-header">
        <span class="result-number">Î•ÏÏÏ„Î·ÏƒÎ· ${i+1}</span>
        <span class="result-status">${ok?"âœ“ Î£Ï‰ÏƒÏ„ÏŒ":"âœ— Î›Î¬Î¸Î¿Ï‚"}</span>
      </div>
      <div class="result-question"><strong>Î•ÏÏÏ„Î·ÏƒÎ·:</strong> ${q.question}</div>
      <div class="user-answer"><strong>Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ® ÏƒÎ±Ï‚:</strong> <span class="answer-choice">${user||"-"}</span> <span class="answer-text">${userText}</span></div>
      ${ok ? "" : `<div class="correct-answer"><strong>Î£Ï‰ÏƒÏ„Î® Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·:</strong> <span class="answer-choice">${correct}</span> <span class="answer-text">${correctText}</span></div>`}
      ${explanationHtml}
    </div>`;
  });


  document.getElementById('results-list').innerHTML = html;
  document.getElementById('quiz-panel').classList.add('hidden');
  document.getElementById('results-modal').classList.remove('hidden');
}

</script>
</body>
</html>
